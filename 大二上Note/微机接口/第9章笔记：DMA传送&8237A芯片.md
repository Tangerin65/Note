# 1.8237A的工作方式
定位：I/O接口-**8237A**-系统总线-存储器，在DMA传输下独立于CPU运行，否则接受处理器控制进行I/O接口数据传输
### 1.1.与DMA的关联
 - 什么是DMA：计算机系统中允许某些硬件子系统（如磁盘控制器、网络适配器或显卡）绕过CPU直接访问RAM的一种功能。
 - 看书：[[微机接口Chapter9.pdf#page=1&selection=37,1,62,16&color=yellow|微机接口Chapter9, p.1]]

### 1.2.内部结构与引脚
 - 寄存器：通道寄存器/控制和状态寄存器[[微机接口Chapter9.pdf#page=1&selection=77,7,116,2&color=yellow|微机接口Chapter9, p.1]]
 - 引脚：![[微机接口Chapter9.pdf#page=1&rect=329,264,585,450&color=yellow|微机接口Chapter9, p.1]]
	 - 请求和响应信号：[[微机接口Chapter9.pdf#page=1&selection=133,0,133,9&color=yellow|微机接口Chapter9, p.1]]，每一个都要看
	 - DMA传送控制信号：[[微机接口Chapter9.pdf#page=2&selection=6,0,7,6&color=yellow|微机接口Chapter9, p.2]]，每一个都要看
	 - 处理器接口信号：[[微机接口Chapter9.pdf#page=2&selection=192,0,192,8&color=yellow|微机接口Chapter9, p.2]]
	 - Sum：![[微机接口Chapter9.pdf#page=2&rect=2,35,592,156&color=yellow|微机接口Chapter9, p.2]]

### 1.3.工作时序/状态
 - 空闲周期：受CPU控制，作为接口电路传输数据，可编程，[[微机接口Chapter9.pdf#page=3&selection=17,0,17,6&color=yellow|微机接口Chapter9, p.3]]
 - 有效周期：独立于CPU运行，控制DMA传输，[[微机接口Chapter9.pdf#page=3&selection=69,0,71,4&color=yellow|微机接口Chapter9, p.3]]
	 - 时序：![[微机接口Chapter9.pdf#page=3&rect=21,202,596,478&color=yellow|微机接口Chapter9, p.3]]
		第二个$S_i$时：DREQ和HRQ为高，进入DMA状态，即$S_0$，但仍在等待总线回应
		第二个$S_0$时：HLDA=1，总线发出响应，DMA传送正式开始
		$S_1$上升沿，AEN=1且ADSTB=1后：开始传输高低位地址，DACK=1通知外设开始数据读写
		$S_2$MEMR和IOW控制读写，输出DMA响应和控制信号，准备进行数据传送
		$S_3$检测数据传送能否完成，决定是否插入等待状态$S_w$
		$S_4$完成数据传送

### 1.4.工作方式
[[微机接口Chapter9.pdf#page=4&selection=165,0,174,19&color=yellow|微机接口Chapter9, p.4]]
 - DMA传送方式：数据以什么节奏和策略传输
	 - 单字节传送：[[微机接口Chapter9.pdf#page=4&selection=187,3,188,6&color=yellow|微机接口Chapter9, p.4]]
	 - 数据块传送： [[微机接口Chapter9.pdf#page=4&selection=276,0,276,7&color=yellow|微机接口Chapter9, p.4]]，这期间CPU长时间无法控制总线
	 - 请求传送方式：可由DREQ信靠控制暂停[[微机接口Chapter9.pdf#page=5&selection=23,0,25,6&color=yellow|微机接口Chapter9, p.5]]
	 - 级联方式：[[微机接口Chapter9.pdf#page=5&selection=92,0,94,4&color=yellow|微机接口Chapter9, p.5]]
- DMA传送类型：[[微机接口Chapter9.pdf#page=5&selection=128,0,130,4&color=yellow|微机接口Chapter9, p.5]]，数据要往哪里去
	- DMA读/DMA写
	- MDA检验(空操作)：验证时序和地址，但断开数据传输
- 存储器间传送：[[微机接口Chapter9.pdf#page=5&selection=204,0,206,11&color=yellow|微机接口Chapter9, p.5]]
- 优先权方式：[[微机接口Chapter9.pdf#page=5&selection=311,0,313,8&color=yellow|微机接口Chapter9, p.5]]
- 自动初始化：[[微机接口Chapter9.pdf#page=6&selection=29,0,30,7&color=yellow|微机接口Chapter9, p.6]]，$\overline{EOP}$信号

---
# 2.8237A寄存器组的作用
用$A_0$到$A_3$进行编码区分
![[微机接口Chapter9.pdf#page=6&rect=11,213,585,504&color=yellow|微机接口Chapter9, p.6]]
 - 现行地址寄存器：存储并提供下一个要访问的内存单元的地址，实时更新[[微机接口Chapter9.pdf#page=6&selection=250,1,250,8&color=note|p.6]]
 - 现行字节数寄存器：DMA传送的剩余字节数，实时更新[[微机接口Chapter9.pdf#page=6&selection=264,1,264,9&color=note|p.6]]
 - 基地址寄存器：存储并保留 CPU 为特定 DMA 通道设定的原始内存起始地址[[微机接口Chapter9.pdf#page=6&selection=281,1,281,7&color=note|p.6]]
 - 基字节数寄存器：[[微机接口Chapter9.pdf#page=7&selection=8,1,8,8&color=note|p.7]]
 - 模式寄存器：存放通道方式控制字+选择某个DMA通道[[微机接口Chapter9.pdf#page=7&selection=91,0,91,5&color=note|p.7]]
 - 命令寄存器：存放芯片命令字[[微机接口Chapter9.pdf#page=7&selection=117,0,117,6&color=note|p.7]]
	 - ![[微机接口Chapter9.pdf#page=8&rect=71,578,574,760&color=yellow|p.8]]
- 请求寄存器：存放DMA请求状态[[微机接口Chapter9.pdf#page=8&selection=100,1,100,6&color=note|p.8]]
	- ![[微机接口Chapter9.pdf#page=8&rect=400,406,589,482&color=yellow|p.8]]
- 屏蔽寄存器：控制外设的DMA请求是否被相应
	- 单通道屏蔽字：[[微机接口Chapter9.pdf#page=8&selection=195,0,197,9&color=yellow|只对一个 DMA 通道屏蔽位进行设置]]
	- 主屏蔽字：[[微机接口Chapter9.pdf#page=8&selection=206,0,210,11&color=yellow|对 4 个 DMA 通道屏蔽位同时进行设置]]
	- 清屏蔽寄存器命令：[[微机接口Chapter9.pdf#page=8&selection=222,0,224,7&color=yellow|使 4 个屏蔽位都清零]]
	- ![[微机接口Chapter9.pdf#page=8&rect=69,144,545,273&color=yellow]]
	- [[微机接口Chapter9.pdf#page=8&selection=236,2,250,3&color=yellow|当一个通道的 DMA 过程结束（内部终止计数 TC 或外部产生玩弄信号），如果不是工作在自动初始化方式，则这一通道的屏蔽位置位，必须再次编程为允许，才能进行下一次 DMA 传送。]]
- 状态寄存器：[[微机接口Chapter9.pdf#page=8&selection=290,1,290,6&color=note|p.8]]
	- 内容含义：[[微机接口Chapter9.pdf#page=8&selection=353,9,369,6&color=note|它的低 4 位反映读命令这个瞬间每个通道是否产生 TC （为 1, 表示该通道传送结束），高 4 位反映每个通道的 DMA 请求情况（为 1, 表示该通道有请求）]]
	- ![[微机接口Chapter9.pdf#page=9&rect=80,652,534,771&color=yellow]]
- 临时寄存器：[[微机接口Chapter9.pdf#page=9&selection=88,0,88,5&color=note|临时寄存器]]
	- only for存储器->存储器模式下作为中间桥梁。传送结束后只保留最后一个字节

---
# 3.8237A的编程
### 3.1.初始化编程
 - 只需写入命令寄存器[[微机接口Chapter9.pdf#page=9&selection=117,9,117,18&color=yellow|p.9]]
### 3.2.DMA传送编程
 - [[微机接口Chapter9.pdf#page=9&selection=136,5,136,14&color=yellow|p.9]]
 - ![[微机接口Chapter9.pdf#page=9&rect=66,394,554,469&color=yellow|p.9]]
 - ![[微机接口Chapter9.pdf#page=9&rect=48,81,540,271&color=yellow|p.9]]
---
# 4.8237A的应用
自己看吧：[[微机接口Chapter9.pdf#page=10&selection=33,0,34,3&color=yellow|p.10]]
![[微机接口Chapter9.pdf#page=10&rect=50,386,556,496&color=yellow|p.10]]
[[微机接口Chapter9.pdf#page=10&selection=235,0,236,6&color=red|8237A 的初始化编程]]/[[微机接口Chapter9.pdf#page=11&selection=30,0,30,7&color=red|高位地址的形成]]
[[微机接口Chapter9.pdf#page=11&selection=187,0,188,3&color=note|DMA 写传送]]
[[微机接口Chapter9.pdf#page=12&selection=176,0,177,5&color=note|DMA 设定子程序]]
